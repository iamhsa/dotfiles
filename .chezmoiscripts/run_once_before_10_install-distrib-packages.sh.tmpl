#!/bin/bash
{{- if (eq .chezmoi.os "linux") }}
{{- if (eq .chezmoi.osRelease.id "debian") }}
sudo apt update -y
sudo apt upgrade -y
{{- if (eq .chezmoi.hostname "lima-debian") }}
sudo apt install -y zsh git unzip curl wget vim python3 python3-pip python3-venv python-is-python3 netcat keychain corkscrew bfs command-not-found software-properties-common lastpass-cli ca-certificates curl gnupg lsb-release rsync lsof tmux jq
{{- else }}
cat << EOF > /etc/apt/sources.list.d/docker.list
deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable
EOF
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin libsecret-1-0 gnome-keyring firefox-esr
wget https://github.com/docker/docker-credential-helpers/releases/download/v0.6.4/docker-credential-secretservice-v0.6.4-amd64.tar.gz
tar -xf docker-credential-secretservice-v0.6.4-amd64.tar.gz
mv docker-credential-secretservice ~/.local/bin/
cat << EOF > ~/.docker/config.json 
{
  "credsStore": "secretservice"
}
sudo usermod -aG docker $(whoami)
EOF
{{- end }}
sudo apt-file update
sudo update-command-not-found
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo apt update
sudo apt install -y packer terraform 
mkdir -p ~/.ssh/keys
chmod 700 ~/.ssh
{{- if (eq .chezmoi.hostname "penguin") }}
cp /mnt/chromeos/GoogleDrive/MyDrive/Identity/ssh/keys/* ~/.ssh/keys/
chmod 600 ~/.ssh/keys/*
cp /mnt/chromeos/GoogleDrive/MyDrive/Identity/ssh/config .ssh/config
touch ~/.ssh/keys/.loadkeys
{{- end -}}
{{- else if (eq .chezmoi.osRelease.id "arch") }}
sudo pacman -Syu --noconfirm
sudo pacman -S --noconfirm zsh git unzip wget vim openbsd-netcat keychain corkscrew
{{- else if (eq .chezmoi.osRelease.id "fedora") }}
sudo dnf -y
sudo dnf install -y zsh git unzip wget vim curl util-linux-user netcat keychain corkscrew
{{- else if (eq .chezmoi.osRelease.id "amzn") }}
sudo yum -y upgrade
sudo yum install -y zsh git unzip wget vim curl util-linux-user netcat keychain corkscrew
{{- else }}
echo "Distribution unsupported for the moment"
exit 1
{{- end }}
{{- else }}
echo "OS unsupported for the moment"
{{- end }}
